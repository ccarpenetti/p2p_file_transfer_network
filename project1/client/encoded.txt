I2luY2x1ZGUgPHN0ZGlvLmg+CiNpbmNsdWRlIDxzdGRsaWIuaD4KI2luY2x1ZGUgPGN0eXBl
Lmg+CiNpbmNsdWRlIDxzdGRib29sLmg+CiNpbmNsdWRlIDx1bmlzdGQuaD4KI2luY2x1ZGUg
PGVycm5vLmg+CiNpbmNsdWRlIDxzdHJpbmcuaD4KI2luY2x1ZGUgPHN5cy90eXBlcy5oPgoj
aW5jbHVkZSA8c3lzL3NvY2tldC5oPgojaW5jbHVkZSA8bmV0aW5ldC9pbi5oPgojaW5jbHVk
ZSA8bmV0ZGIuaD4KI2luY2x1ZGUgPGFycGEvaW5ldC5oPgojaW5jbHVkZSA8c3lzL3dhaXQu
aD4KI2luY2x1ZGUgPHNpZ25hbC5oPgoKI2RlZmluZSBCQUNLTE9HIDEwCiNkZWZpbmUgTUFY
REFUQVNJWkUgMTAwCgppbnQgc2VydmVyX2ZkOwoKLy8gSGFuZGxlciBmb3IgQ1RSTC1DCnZv
aWQgc2lnX2hhbmRsZXIoaW50IHMpIHsKCiAgICBwcmludGYoIkNvbnRyb2wtQyBkZXRlY3Rl
ZCAtIHNodXR0aW5nIGRvd24gc2VydmVyXG4iKTsKICAgIGNsb3NlKHNlcnZlcl9mZCk7CiAg
ICBleGl0KDApOwoKfQoKYm9vbCBjaGVja19wb3J0KGNoYXIgKnBvcnQpewogICAgCiAgICAv
LyBJdGVyYXRlIHRocm91Z2ggcG9ydCBhcmd1bWVudCB0byBzZWUgaWYgaXQgY29udGFpbnMg
YWxsIGRpZ2l0cwogICAgd2hpbGUgKCpwb3J0KSB7CgogICAgICAgIGlmIChpc2RpZ2l0KCpw
b3J0KSA9PSBmYWxzZSkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQog
ICAgICAgIHBvcnQrKzsKICAgIH0KCiAgICByZXR1cm4gdHJ1ZTsKfQoKLy8gR2V0IHNvY2tl
dCBhZGRyZXNzLCBJUHY0IG9yIElQdjYKdm9pZCAqZ2V0X2luX2FkZHIoc3RydWN0IHNvY2th
ZGRyICpzYSkgewoKICAgIGlmIChzYS0+c2FfZmFtaWx5ID09IEFGX0lORVQpIHsKICAgICAg
ICByZXR1cm4gJigoKHN0cnVjdCBzb2NrYWRkcl9pbiopc2EpLT5zaW5fYWRkcik7CiAgICB9
CgogICAgcmV0dXJuICYoKChzdHJ1Y3Qgc29ja2FkZHJfaW42KilzYSktPnNpbjZfYWRkcik7
Cn0KCi8vSW52ZXJ0IHN0cmluZwpjaGFyICppbnZlcnNlX3N0cmluZyhjaGFyICpzdHIpewoK
ICAgIGludCBsZW4gPSBzdHJsZW4oc3RyKTsKICAgIGNoYXIgbmV3X3N0cltsZW5dOwogICAg
aW50IGkgPSAwOwoKICAgIHdoaWxlIChsZW4gPiAwKSB7CiAgICAgICAgbmV3X3N0cltpXSA9
IHN0cltsZW4gLSAxXTsKICAgICAgICBpKys7CiAgICAgICAgbGVuLS07CiAgICB9CgogICAg
bmV3X3N0cltpXSA9ICdcMCc7CgogICAgc3RyY3B5KHN0ciwgbmV3X3N0cik7CiAgICByZXR1
cm4gc3RyOwoKfQoKaW50IG1haW4oaW50IGFyZ2MsIGNoYXIgKmFyZ3ZbXSl7CgogICAgLy8g
Q2hlY2sgZm9yIGNvcnJlY3QgbnVtYmVyIG9mIGFyZ3VtZW50cwogICAgaWYgKGFyZ2MgIT0g
MikgewogICAgICAgIHByaW50ZigiRXJyb3I6IGluY29ycmVjdCBudW1iZXIgb2YgYXJndW1l
bnRzLlxuIik7CiAgICAgICAgcmV0dXJuIDA7CiAgICB9CgogICAgLy9DaGVjayB0aGF0IHRo
ZSB1c2VyIGVudGVyZWQgYSB2YWxpZCBwb3J0IHZhbHVlIChpLmUuIGEgbnVtYmVyKQogICAg
aWYgKGNoZWNrX3BvcnQoYXJndlsxXSkgPT0gZmFsc2UpIHsKICAgICAgICBwcmludGYoIkVy
cm9yOiBpbnZhbGlkIHBvcnQgbnVtYmVyLlxuIik7CiAgICAgICAgcmV0dXJuIDE7CiAgICB9
CgogICAgaW50IHNlcnZlcl9mZCwgY2xpZW50X2ZkOyAvLyBXaWxsIGJlIGxpc3RlbmluZyBv
biBzZXJ2ZXJfZmQsIG5ldyBjb25uZWN0aW9uIHdpdGggY2xpZW50X2ZkCgogICAgaW50IHJ2
LCBudW1ieXRlczsKICAgIGludCB5ZXMgPSAxOwoKICAgIHN0cnVjdCBhZGRyaW5mbyBoaW50
cywgKnNlcnZpbmZvLCAqcDsgCiAgICBzdHJ1Y3Qgc29ja2FkZHJfc3RvcmFnZSB0aGVpcl9h
ZGRyOyAvLyBob2xkJ3MgdGhlIGNsaWVudCdzIGFkZHJlc3MgaW5mb3JtYXRpb24KCiAgICBj
aGFyIHNbSU5FVDZfQUREUlNUUkxFTl07IC8vIHN0b3JlIHN0cmluZyBmb3JtIG9mIGFkZHJl
c3MKICAgIG1lbXNldChzLCAwLCBzaXplb2YocykpOwogIAogICAgY2hhciBidWZbTUFYREFU
QVNJWkVdOwogICAgbWVtc2V0KGJ1ZiwgMCwgc2l6ZW9mKGJ1ZikpOwogICAgCiAgICAvLyB3
aWxsIGhvbGQgb3VyIHJlc3BvbnNlIG1lc3NhZ2VzCiAgICBjaGFyIGNvZGVbTUFYREFUQVNJ
WkVdOyAgICAgICAgCiAgICBjaGFyIGNvbnRlbnRfbGVuZ3RoW01BWERBVEFTSVpFXTsgICAg
ICAgIAogICAgY2hhciBpbnZlcnNpb25bTUFYREFUQVNJWkVdOyAgIAogICAgICAgIAogCiAg
ICAvLyBJbml0aWFsaXplIHNwZWNpZmljYXRpb25zIGZvciBjb21tdW5pY2F0aW9uCiAgICBt
ZW1zZXQoJmhpbnRzLCAwLCBzaXplb2YoaGludHMpKTsKICAgIGhpbnRzLmFpX2ZhbWlseSA9
IEFGX1VOU1BFQzsKICAgIGhpbnRzLmFpX3NvY2t0eXBlID0gU09DS19TVFJFQU07CiAgICBo
aW50cy5haV9mbGFncyA9IEFJX1BBU1NJVkU7CgogICAgLy8gQ29ubmVjdCBzaWduYWwgaGFu
ZGxlcgogICAgc3RydWN0IHNpZ2FjdGlvbiBzYTsKICAgIHNhLnNhX2hhbmRsZXIgPSBzaWdf
aGFuZGxlcjsKICAgIHNpZ2VtcHR5c2V0KCZzYS5zYV9tYXNrKTsKICAgIHNhLnNhX2ZsYWdz
ID0gU0FfUkVTVEFSVDsKICAgIGlmIChzaWdhY3Rpb24oU0lHSU5ULCAmc2EsIE5VTEwpID09
IC0xKSB7CiAgICAgICAgcGVycm9yKCJzaWdhY3Rpb24iKTsKICAgICAgICByZXR1cm4gMTsK
ICAgIH0KCiAgICAvLyBHZXQgYWRkcmVzcyBpbmZvIHRoYXQgbWF0Y2hlcyBwb3J0IGFuZCBo
aW50cwogICAgaWYgKChydiA9IGdldGFkZHJpbmZvKE5VTEwsIGFyZ3ZbMV0sICZoaW50cywg
JnNlcnZpbmZvKSkgIT0gMCkgewogICAgICAgIGZwcmludGYoc3RkZXJyLCAiZ2V0YWRkcmlu
Zm86ICVzXG4iLCBnYWlfc3RyZXJyb3IocnYpKTsKICAgICAgICByZXR1cm4gMTsKICAgIH0K
ICAgIAogICAgZm9yIChwID0gc2VydmluZm87IHAgIT0gTlVMTDsgcCA9IHAtPmFpX25leHQp
IHsKCiAgICAgICAgLy8gSWYgYSBzb2NrZXQgY2Fubm90IGJlIGNyZWF0ZWQgd2l0aCB0aGUg
Y3VycmVudCBhZGRyZXNzIGluZm9ybWF0aW9uIHN0cnVjdCwgY29udGludWUKICAgICAgICBp
ZiAoKHNlcnZlcl9mZCA9IHNvY2tldChwLT5haV9mYW1pbHksIHAtPmFpX3NvY2t0eXBlLCBw
LT5haV9wcm90b2NvbCkpID09IC0xKSB7CiAgICAgICAgICAgIHBlcnJvcigic2VydmVyOiBz
b2NrZXQiKTsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgCiAgICAgICAg
Ly8gSWYgeW91IGNhbm5vdCBzZXQgdGhlIHNvY2tldCBvcHRpb25zLCByYWlzZSBlcnJvcgog
ICAgICAgIGlmIChzZXRzb2Nrb3B0KHNlcnZlcl9mZCwgU09MX1NPQ0tFVCwgU09fUkVVU0VB
RERSLCAmeWVzLCBzaXplb2YoaW50KSkgPT0gLTEpIHsKICAgICAgICAgICAgcGVycm9yKCJz
ZXRzb2Nrb3B0Iik7CiAgICAgICAgICAgIHJldHVybiAxOwogICAgICAgIH0KCiAgICAgICAg
Ly8gSWYgeW91IGZhaWwgdG8gYmluZCwgcmFpc2UgZXJyb3IgYW5kIHRyeSBhbm90aGVyIGFk
ZHJlc3MKICAgICAgICBpZiAoYmluZChzZXJ2ZXJfZmQsIHAtPmFpX2FkZHIsIHAtPmFpX2Fk
ZHJsZW4pID09IC0xKSB7CiAgICAgICAgICAgIGNsb3NlKHNlcnZlcl9mZCk7CiAgICAgICAg
ICAgIHBlcnJvcigic2VydmVyOiBiaW5kIik7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAg
ICAgIH0KCiAgICAgICAgYnJlYWs7CgogICAgfQoKICAgIGZyZWVhZGRyaW5mbyhzZXJ2aW5m
byk7CgogICAgaWYgKHAgPT0gTlVMTCl7CiAgICAgICAgZnByaW50ZihzdGRlcnIsICJzZXJ2
ZXI6IGZhaWxlZCB0byBiaW5kXG4iKTsKICAgICAgICByZXR1cm4gMTsKICAgIH0KCiAgICBp
ZiAobGlzdGVuKHNlcnZlcl9mZCwgQkFDS0xPRykgPT0gLTEpIHsKICAgICAgICBwZXJyb3Io
Imxpc3RlbiIpOwogICAgICAgIHJldHVybiAxOwogICAgfQoKICAgIHByaW50ZigiU2VydmVy
IHN1Y2Nlc3NmdWxseSBzdGFydGVkIGxpc3RlbmluZyBvbiBQb3J0ICVzXG4iLCBhcmd2WzFd
KTsKCiAgICBzb2NrbGVuX3Qgc2luX3NpemU7ICAgIAoKICAgIC8vIE1haW4gYWNjZXB0IGxv
b3AKICAgIHdoaWxlKDEpIHsKCiAgICAgICAgcHJpbnRmKCJXYWl0aW5nIGZvciBuZXcgY29u
bmVjdGlvbnMuLi5cbiIpOwoKICAgICAgICBzaW5fc2l6ZSA9IHNpemVvZih0aGVpcl9hZGRy
KTsKICAgICAgICBjbGllbnRfZmQgPSBhY2NlcHQoc2VydmVyX2ZkLCAoc3RydWN0IHNvY2th
ZGRyICopJnRoZWlyX2FkZHIsICZzaW5fc2l6ZSk7CgogICAgICAgIGlmIChjbGllbnRfZmQg
PT0gLTEpewogICAgICAgICAgICBwZXJyb3IoImFjY2VwdCIpOwogICAgICAgICAgICBjb250
aW51ZTsKICAgICAgICB9CgogICAgICAgIC8vIEdldCBJUCBzdHJpbmcgb2YgY2xpZW50J3Mg
YWRkcmVzcwogICAgICAgIGluZXRfbnRvcCh0aGVpcl9hZGRyLnNzX2ZhbWlseSwgZ2V0X2lu
X2FkZHIoKHN0cnVjdCBzb2NrYWRkciAqKSZ0aGVpcl9hZGRyKSwgcywgc2l6ZW9mKHMpKTsK
ICAgICAgICAKICAgICAgICBwcmludGYoIk5ldyBjbGllbnQgZGV0ZWN0ZWQhXG4iKTsKCiAg
ICAgICAgLy9SZWNlaXZlIHJlcXVlc3QgZnJvbSBjbGllbnQKICAgICAgICBpZiAoKG51bWJ5
dGVzID0gcmVjdihjbGllbnRfZmQsIGJ1ZiwgTUFYREFUQVNJWkUgLSAxLCAwKSkgPT0gLTEp
IHsKICAgICAgICAgICAgcGVycm9yKCJzZXJ2ZXIgcmVjdiIpOwogICAgICAgICAgICByZXR1
cm4gMTsKICAgICAgICB9CgogICAgICAgIC8vRm9yY2UgdGhlIHRlcm1pbmF0aW9uIG9mIHRo
ZSByZXF1ZXN0IHN0cmluZwogICAgICAgIGJ1ZltudW1ieXRlc10gPSAnXDAnOyAKICAgIAog
ICAgICAgIC8vIFByaW50IHJlcXVlc3QgZnJvbSBjbGllbnQKICAgICAgICBwcmludGYoIiVz
XG4iLCBidWYpOwoKICAgICAgICAvLyBDbGVhciBjb250ZW50cyBvZiByZXNwb25zZSBidWZm
ZXJzCiAgICAgICAgbWVtc2V0KCZjb2RlLCAwLCBzaXplb2YoY29kZSkpOwogICAgICAgIG1l
bXNldCgmY29udGVudF9sZW5ndGgsIDAsIHNpemVvZihjb250ZW50X2xlbmd0aCkpOwogICAg
ICAgIG1lbXNldCgmaW52ZXJzaW9uLCAwLCBzaXplb2YoaW52ZXJzaW9uKSk7CgogICAgICAg
IC8vIElmIHRoZSBjb21tYW5kIGlzIGFueXRoaW5nIGJ1dCBJTlZFUlQKICAgICAgICBpZiAo
IXN0cnN0cihidWYsICJJTlZFUlQiKSl7CiAgICAgICAgICAgIC8vU2VuZCBlcnJvciBtZXNz
YWdlIHRvIGNsaWVudAogICAgICAgICAgICBzdHJjcHkoY29kZSwgIjUwMSBOT1QgSU1QTEVN
RU5URUQiKTsKICAgICAgICAgICAgaWYgKHNlbmQoY2xpZW50X2ZkLCBjb2RlLCBzdHJsZW4o
Y29kZSksIDApID09IC0xKSB7CiAgICAgICAgICAgICAgICBwZXJyb3IoInNlcnZlcjogc2Vu
ZCIpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAg
ICAKICAgICAgICAgICAgc3RyY3B5KGNvZGUsICIyMDAgT0siKTsKICAgICAgICAgICAgCiAg
ICAgICAgICAgIGNoYXIgKndvcmQ7CiAgICAgICAgICAgIHdvcmQgPSBzdHJjaHIoYnVmLCAn
ICcpOwogICAgICAgICAgICB3b3JkKys7CiAgICAgICAgICAgIAogICAgICAgICAgICBzcHJp
bnRmKGNvbnRlbnRfbGVuZ3RoLCAiQ29udGVudC1MZW5ndGg6ICVkIiwgc3RybGVuKHdvcmQp
KTsKICAgICAgICAgICAgc3ByaW50ZihpbnZlcnNpb24sICJJbnZlcnNpb246ICVzIiwgaW52
ZXJzZV9zdHJpbmcod29yZCkpOwoKICAgICAgICAgICAgaWYgKHNlbmQoY2xpZW50X2ZkLCBj
b2RlLCBzdHJsZW4oY29kZSksIDApID09IC0xKSB7CiAgICAgICAgICAgICAgICBwZXJyb3Io
InNlcnZlcjogc2VuZCIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAg
ICBwcmludGYoIlNlbnQ6ICVzXG4iLCBjb2RlKTsKCiAgICAgICAgICAgIGlmIChzZW5kKGNs
aWVudF9mZCwgY29udGVudF9sZW5ndGgsIHN0cmxlbihjb250ZW50X2xlbmd0aCksIDApID09
IC0xKSB7CiAgICAgICAgICAgICAgICBwZXJyb3IoInNlcnZlcjogc2VuZCIpOwogICAgICAg
ICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICBwcmludGYoIlNlbnQ6ICVzXG4iLCBj
b250ZW50X2xlbmd0aCk7CgogICAgICAgICAgICBpZiAoc2VuZChjbGllbnRfZmQsIGludmVy
c2lvbiwgc3RybGVuKGludmVyc2lvbiksIDApID09IC0xKSB7CiAgICAgICAgICAgICAgICBw
ZXJyb3IoInNlcnZlcjogc2VuZCIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAg
ICAgICAgICBwcmludGYoIlNlbnQ6ICVzXG4iLCBpbnZlcnNpb24pOwoKICAgICAgICAgICAg
CgogICAgICAgIH0KCiAgICAgICAgcHJpbnRmKCJDbGllbnQgY29ubmVjdGlvbiBmaW5pc2hl
ZCFcbiIpOwogICAgICAgIGNsb3NlKGNsaWVudF9mZCk7CiAgCiAgICAgICAgbWVtc2
